# Core runtime
NODE_ENV=development
PORT=3000
REQUEST_BODY_LIMIT_MB=5
FRONTEND_URL=http://18.143.76.86:3001
FRONTEND_ALLOWED_ORIGINS=https://system.pos-hub.shop,http://18.143.76.86:3001,http://localhost:3001
# Cookie security override:
# - false: allow HTTP deployments (EC2 public IP without TLS)
# - true: force Secure cookies (HTTPS only)
COOKIE_SECURE=false
# Optional: share auth cookies across subdomains (e.g. system/api)
# Set to parent domain without protocol.
# COOKIE_DOMAIN=pos-hub.shop
JWT_SECRET=f8a7b0bbdd1e218c8d9b8e6021c29b2870d32f1b5a08fd7a408c5e3ed5f16e6b

# Database
DATABASE_HOST=aws-1-ap-southeast-1.pooler.supabase.com
DATABASE_PORT=6543
DATABASE_USER=postgres.ybicqsnqhwbjwmuqyrzd
DATABASE_PASSWORD=ps1M7XWjRWQAn5Zy
DATABASE_NAME=postgres
DATABASE_SSL=true
DATABASE_SSL_REJECT_UNAUTHORIZED=false
DATABASE_POOL_MAX=10
DATABASE_POOL_MIN=5
DATABASE_CONNECTION_TIMEOUT_MS=5000
DATABASE_IDLE_TIMEOUT_MS=30000
STATEMENT_TIMEOUT_MS=30000
TYPEORM_SYNC=false
ALLOW_TYPEORM_SYNC_WITH_NON_OWNER=1
ALLOW_BYPASSRLS=1
ALLOW_SUPERUSER_DB_ROLE=1
ENFORCE_DB_ROLE_POLICY=1
RUN_MIGRATIONS_ON_START=true
REQUIRE_NO_PENDING_MIGRATIONS=true

# RBAC baseline seed
RUN_RBAC_BASELINE_ON_START=true
BOOTSTRAP_DEFAULT_BRANCH_NAME=Main Branch
BOOTSTRAP_DEFAULT_BRANCH_CODE=MB
BOOTSTRAP_ADMIN_USERNAME=admin
BOOTSTRAP_ADMIN_PASSWORD=27451tenX.
BOOTSTRAP_ADMIN_NAME=System Administrator
BOOTSTRAP_ADMIN_BRANCH_ID=

# Redis (app/session/cache)
REDIS_URL=redis://default:5DGz0cgRnnPUSWAIUl2RLosyKbFDtpoy@redis-12881.c292.ap-southeast-1-1.ec2.cloud.redislabs.com:12881
REDIS_TLS=false
REDIS_TLS_REJECT_UNAUTHORIZED=false
REDIS_TLS_AUTO_FALLBACK=true
REDIS_CONNECT_TIMEOUT_MS=5000
REDIS_DISABLED=true
REDIS_PREFIX=pos-prod

# Redis (rate limit)
RATE_LIMIT_REDIS_URL=redis://default:5DGz0cgRnnPUSWAIUl2RLosyKbFDtpoy@redis-12881.c292.ap-southeast-1-1.ec2.cloud.redislabs.com:12881
RATE_LIMIT_REDIS_TLS=false
RATE_LIMIT_REDIS_TLS_REJECT_UNAUTHORIZED=false
RATE_LIMIT_REDIS_TLS_AUTO_FALLBACK=true
RATE_LIMIT_REDIS_DISABLED=true
RATE_LIMIT_REDIS_CONNECT_TIMEOUT_MS=5000
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=20000
RATE_LIMIT_AUTH_WINDOW_MS=900000
RATE_LIMIT_AUTH_MAX=20
RATE_LIMIT_ORDER_WINDOW_MS=60000
RATE_LIMIT_ORDER_MAX=30
RATE_LIMIT_PAYMENT_WINDOW_MS=300000
RATE_LIMIT_PAYMENT_MAX=50
RATE_LIMIT_PASSWORD_RESET_WINDOW_MS=3600000
RATE_LIMIT_PASSWORD_RESET_MAX=5

# Session and socket
SESSION_TIMEOUT_MS=28800000
# Revalidate user/role from DB every N ms (session snapshot serves between checks)
AUTH_USER_DB_REVALIDATE_MS=300000
# Branch context validation cache TTL in middleware (ms)
BRANCH_VALIDATION_CACHE_TTL_MS=60000
SOCKET_REDIS_ADAPTER_ENABLED=false
SOCKET_IO_PATH=/socket.io

# Metrics and health
METRICS_ENABLED=true
METRICS_API_KEY=U0RL05mLGtqsQOqhJsFl41HYS23kPbJh3Z8mIpUddNQmLluZC4T4y6nPBexuD2Kh
HEALTH_RETENTION_STALE_HOURS=36

# Retention cleanup (for cronjob)
RETENTION_LOG_FILE=logs/retention-jobs.log
RETENTION_WARN_DELETED_TOTAL=5000
ORDER_RETENTION_ENABLED=true
ORDER_RETENTION_DRY_RUN=false
ORDER_RETENTION_DAYS=30
ORDER_QUEUE_RETENTION_ENABLED=true
ORDER_QUEUE_RETENTION_DRY_RUN=false
ORDER_QUEUE_RETENTION_DAYS=14
STOCK_ORDER_RETENTION_ENABLED=true
STOCK_ORDER_RETENTION_DRY_RUN=false
STOCK_ORDER_RETENTION_DAYS=7
AUDIT_LOG_RETENTION_ENABLED=true
AUDIT_LOG_RETENTION_DRY_RUN=false
AUDIT_LOG_RETENTION_DAYS=90

# Optional performance logs
ENABLE_PERF_LOG=false
ENABLE_SLOW_REQUEST_LOG=false
SLOW_REQUEST_THRESHOLD_MS=800
# Debug metric logging (WARNING: high I/O overhead in production)
ENABLE_MONITORING_METRIC_LOG=false
# Exclude internal endpoints from in-memory monitoring samples
MONITORING_SKIP_PATHS=/health,/metrics,/csrf-token,/system/health
# Exclude internal endpoints from Health-System latency calculation
HEALTH_PERF_EXCLUDED_PATHS=/health,/metrics,/csrf-token,/system/health
# Top slow endpoint report config for Health-System
HEALTH_TOP_SLOW_ENDPOINTS_LIMIT=5
HEALTH_TOP_SLOW_ENDPOINTS_MIN_SAMPLES=20
HEALTH_PERF_METRIC_WINDOW_LIMIT=500
# User-facing/admin traffic classification for latency guards
HEALTH_PERF_USER_INCLUDE_PATHS=/pos,/stock
HEALTH_PERF_ADMIN_INCLUDE_PATHS=/auth,/permissions,/users,/roles,/branch,/branches,/system,/audit
# User-facing latency guard
HEALTH_P95_WARN_MS=250
HEALTH_P99_WARN_MS=500
# Admin/Auth latency guard (more lenient to avoid false positives)
HEALTH_ADMIN_P95_WARN_MS=900
HEALTH_ADMIN_P99_WARN_MS=1500
# Startup cache warmup (safe background run after boot)
STARTUP_WARMUP_ENABLED=true
STARTUP_WARMUP_DELAY_MS=12000
STARTUP_WARMUP_BRANCH_LIMIT=3
STARTUP_WARMUP_TASK_TIMEOUT_MS=4500
STARTUP_WARMUP_PRODUCTS_ENABLED=true
STARTUP_WARMUP_PRODUCTS_LIMIT=20
STARTUP_WARMUP_DASHBOARD_TOP_LIMIT=7
STARTUP_WARMUP_DASHBOARD_RECENT_LIMIT=8
# Conservative dashboard read-cache TTL
DASHBOARD_SALES_CACHE_TTL_MS=20000
DASHBOARD_TOP_ITEMS_CACHE_TTL_MS=20000
DASHBOARD_OVERVIEW_CACHE_TTL_MS=20000
# Read cache TTL for queue list (writes still invalidate immediately)
ORDER_QUEUE_CACHE_TTL_MS=10000
